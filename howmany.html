<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>How Many Game</title>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Nunito', sans-serif;
      background-color: #fffdf5;
      color: #333;
      text-align: center;
      padding: 20px;
      margin: 0;
      overflow-x: hidden;
    }

    h1 {
      margin-bottom: 20px;
      font-weight: 700;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 15px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .item {
      background-color: transparent;
      border-radius: 10px;
      padding: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0);
      min-width: 80px;
    }

    .emoji {
      font-size: 2rem;
      margin-bottom: 8px;
    }

    .name {
      font-size: 0.9rem;
      font-weight: 600;
      line-height: 1.2;
    }

    #game-area {
      position: relative;
      width: 90vw;
      height: 70vh;
      margin: 0 auto;
      overflow: hidden;
      display: none;
      border: 2px dashed #ccc;
      border-radius: 10px;
      background-color: #fffefb;
    }

    .floating-emoji {
      position: absolute;
      font-size: 5rem;
      user-select: none;
      pointer-events: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 80px;
      height: 80px;
    }

    #question {
      font-size: 3.5rem;
      font-weight: 700;
      margin: 20px 0;
      min-height: 40px;
    }

    .instruction {
      margin-top: 20px;
      font-size: 1.1rem;
      color: #666;
    }
  </style>
</head>
<body>

  <h1 id="title">How Many?</h1>
<div class="grid" id="object-grid">
<div class="item"><div class="emoji">ğŸ</div><div class="name">apples</div></div>
<div class="item"><div class="emoji">ğŸŒ</div><div class="name">bananas</div></div>
<div class="item"><div class="emoji">ğŸ‰</div><div class="name">watermelons</div></div>
<div class="item"><div class="emoji">ğŸ</div><div class="name">pineapples</div></div>
<div class="item"><div class="emoji">ğŸ“</div><div class="name">strawberries</div></div>
<div class="item"><div class="emoji">ğŸ‚</div><div class="name">cakes</div></div>
<div class="item"><div class="emoji">ğŸª</div><div class="name">cookies</div></div>
<div class="item"><div class="emoji">ğŸ«</div><div class="name">chocolates</div></div>
<div class="item"><div class="emoji">ğŸ©</div><div class="name">donuts</div></div>
<div class="item"><div class="emoji">ğŸ¦</div><div class="name">ice creams</div></div>
<div class="item"><div class="emoji">ğŸ¶</div><div class="name">dogs</div></div>
<div class="item"><div class="emoji">ğŸ±</div><div class="name">cats</div></div>
<div class="item"><div class="emoji">ğŸ­</div><div class="name">mice</div></div>
<div class="item"><div class="emoji">ğŸ¦</div><div class="name">lions</div></div>
<div class="item"><div class="emoji">ğŸ˜</div><div class="name">elephants</div></div>
<div class="item"><div class="emoji">ğŸ»</div><div class="name">bears</div></div>
<div class="item"><div class="emoji">ğŸ¼</div><div class="name">pandas</div></div>
<div class="item"><div class="emoji">ğŸ¦</div><div class="name">birds</div></div>
<div class="item"><div class="emoji">ğŸ¸</div><div class="name">frogs</div></div>
<div class="item"><div class="emoji">ğŸ´</div><div class="name">horses</div></div>
<div class="item"><div class="emoji">ğŸ’</div><div class="name">monkeys</div></div>
<div class="item"><div class="emoji">â­</div><div class="name">stars</div></div>
<div class="item"><div class="emoji">ğŸŸ¢</div><div class="name">green circles</div></div>
<div class="item"><div class="emoji">ğŸŸ¥</div><div class="name">red squares</div></div>
<div class="item"><div class="emoji">ğŸŒ</div><div class="name">suns</div></div>
<div class="item"><div class="emoji">ğŸŒˆ</div><div class="name">rainbows</div></div>
<div class="item"><div class="emoji">ğŸŒ³</div><div class="name">trees</div></div>
<div class="item"><div class="emoji">ğŸŒ»</div><div class="name">flowers</div></div>
<div class="item"><div class="emoji">ğŸ§¸</div><div class="name">teddy bears</div></div>
<div class="item"><div class="emoji">ğŸ</div><div class="name">presents</div></div>
<div class="item"><div class="emoji">ğŸš—</div><div class="name">cars</div></div>
<div class="item"><div class="emoji">âœˆï¸</div><div class="name">airplanes</div></div>
<div class="item"><div class="emoji">âš½</div><div class="name">soccer balls</div></div>
<div class="item"><div class="emoji">ğŸˆ</div><div class="name">balloons</div></div>
<div class="item"><div class="emoji">ğŸ“¦</div><div class="name">boxes</div></div>
<div class="item"><div class="emoji">ğŸš²</div><div class="name">bicycles</div></div>
<div class="item"><div class="emoji">ğŸš‚</div><div class="name">trains</div></div>
<div class="item"><div class="emoji">ğŸ›¸</div><div class="name">aliens</div></div>
<div class="item"><div class="emoji">ğŸ‘©</div><div class="name">mothers</div></div>
<div class="item"><div class="emoji">ğŸ‘¨</div><div class="name">fathers</div></div>
<div class="item"><div class="emoji">ğŸ‘µ</div><div class="name">grandmothers</div></div>
<div class="item"><div class="emoji">ğŸ‘´</div><div class="name">grandfathers</div></div>
<div class="item"><div class="emoji">ğŸ‘§</div><div class="name">girls</div></div>
<div class="item"><div class="emoji">ğŸ‘¦</div><div class="name">boys</div></div>
<div class="item"><div class="emoji">ğŸ‘»</div><div class="name">ghosts</div></div>
<div class="item"><div class="emoji">ğŸ“š</div><div class="name">books</div></div>
<div class="item"><div class="emoji">âœï¸</div><div class="name">pencils</div></div>
</div>
  
  <div id="game-area">
    <div id="question">How many do you see?</div>
  </div>

  <script>
    let gameState = 'menu';
    let animationId;
    let emojis = [];
    let currentCount = 0;
    let currentObject = null;
    let availableObjects = [];
    let usedObjects = [];

    function getObjectsFromGrid() {
      const items = document.querySelectorAll('#object-grid .item');
      return Array.from(items).map(item => {
        return {
          emoji: item.querySelector('.emoji').textContent.trim(),
          name: item.querySelector('.name').textContent.trim()
        };
      });
    }

    function initializeObjectQueue() {
      const allObjects = getObjectsFromGrid();
      availableObjects = [...allObjects];
      usedObjects = [];
      
      // Shuffle the available objects for variety
      for (let i = availableObjects.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [availableObjects[i], availableObjects[j]] = [availableObjects[j], availableObjects[i]];
      }
    }

    function getNextObject() {
      // If we've used all objects, reset and reshuffle
      if (availableObjects.length === 0) {
        availableObjects = [...usedObjects];
        usedObjects = [];
        
        // Shuffle again for the next cycle
        for (let i = availableObjects.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [availableObjects[i], availableObjects[j]] = [availableObjects[j], availableObjects[i]];
        }
      }
      
      // Get the next object from available objects
      const nextObject = availableObjects.pop();
      usedObjects.push(nextObject);
      return nextObject;
    }

    function createEmojiObject(emoji, gameAreaRect) {
      const size = 80;
      return {
        element: null,
        emoji: emoji,
        x: Math.random() * (gameAreaRect.width - size),
        y: Math.random() * (gameAreaRect.height - size),
        vx: (Math.random() - 0.5) * 4,
        vy: (Math.random() - 0.5) * 4,
        size: size
      };
    }

    function checkCollision(emoji1, emoji2) {
      const dx = emoji1.x - emoji2.x;
      const dy = emoji1.y - emoji2.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      return distance < emoji1.size * 0.8;
    }

    function resolveCollision(emoji1, emoji2) {
      const dx = emoji1.x - emoji2.x;
      const dy = emoji1.y - emoji2.y;
      const distance = Math.sqrt(dx * dx + dy * dy);
      
      if (distance === 0) return;
      
      const normalX = dx / distance;
      const normalY = dy / distance;
      
      const relativeVelocityX = emoji1.vx - emoji2.vx;
      const relativeVelocityY = emoji1.vy - emoji2.vy;
      
      const velocityInNormal = relativeVelocityX * normalX + relativeVelocityY * normalY;
      
      if (velocityInNormal > 0) return;
      
      const restitution = 0.8;
      const impulse = 2 * velocityInNormal * restitution / 2;
      
      emoji1.vx -= impulse * normalX;
      emoji1.vy -= impulse * normalY;
      emoji2.vx += impulse * normalX;
      emoji2.vy += impulse * normalY;
      
      const overlap = emoji1.size * 0.8 - distance;
      if (overlap > 0) {
        emoji1.x += normalX * overlap * 0.5;
        emoji1.y += normalY * overlap * 0.5;
        emoji2.x -= normalX * overlap * 0.5;
        emoji2.y -= normalY * overlap * 0.5;
      }
    }

    function animate() {
      const gameArea = document.getElementById('game-area');
      const gameAreaRect = gameArea.getBoundingClientRect();
      const maxX = gameAreaRect.width - 80;
      const maxY = gameAreaRect.height - 80;

      emojis.forEach(emoji => {

        emoji.x += emoji.vx;
        emoji.y += emoji.vy;

        if (emoji.x <= 0 || emoji.x >= maxX) {
          emoji.vx = -emoji.vx;
          emoji.x = Math.max(0, Math.min(maxX, emoji.x));
        }
        if (emoji.y <= 0 || emoji.y >= maxY) {
          emoji.vy = -emoji.vy;
          emoji.y = Math.max(0, Math.min(maxY, emoji.y));
        }


        if (emoji.element) {
          emoji.element.style.left = `${emoji.x}px`;
          emoji.element.style.top = `${emoji.y}px`;
        }
      });

      for (let i = 0; i < emojis.length; i++) {
        for (let j = i + 1; j < emojis.length; j++) {
          if (checkCollision(emojis[i], emojis[j])) {
            resolveCollision(emojis[i], emojis[j]);
          }
        }
      }

      animationId = requestAnimationFrame(animate);
    }

    function startGame() {
      const title = document.getElementById("title");
      const objectGrid = document.getElementById("object-grid");
      const gameArea = document.getElementById("game-area");

      if (title) title.remove();
      objectGrid.style.display = "none";
      gameArea.style.display = "block";

      gameState = 'counting';
      initializeObjectQueue();
      setupNewQuestion();
    }

    function setupNewQuestion() {
      const gameArea = document.getElementById("game-area");
      const question = document.getElementById("question");

      if (animationId) {
        cancelAnimationFrame(animationId);
      }
      gameArea.querySelectorAll(".floating-emoji").forEach(e => e.remove());
      emojis = [];

      currentObject = getNextObject();
      currentCount = Math.floor(Math.random() * 9) + 2;

      question.textContent = `There are _ ${currentObject.name}`;
      gameState = 'counting';

      const gameAreaRect = gameArea.getBoundingClientRect();

      for (let i = 0; i < currentCount; i++) {
        const emojiData = createEmojiObject(currentObject.emoji, gameAreaRect);
        
        const emojiEl = document.createElement("div");
        emojiEl.className = "floating-emoji";
        emojiEl.textContent = emojiData.emoji;
        emojiEl.style.left = `${emojiData.x}px`;
        emojiEl.style.top = `${emojiData.y}px`;
        
        emojiData.element = emojiEl;
        gameArea.appendChild(emojiEl);
        emojis.push(emojiData);
      }

      animate();
    }

    function revealAnswer() {
      const question = document.getElementById("question");
      
      if (gameState === 'counting') {
        question.textContent = `There are ${currentCount} ${currentObject.name}`;
        gameState = 'revealed';
      } else if (gameState === 'revealed') {
        setupNewQuestion();
      }
    }

    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        }
      }
    }

    document.addEventListener("keydown", (e) => {
      if (gameState === 'menu') {
        toggleFullscreen();
        startGame();
      } else if (gameState === 'counting' || gameState === 'revealed') {
        revealAnswer();
      }
    });
  </script>
</body>
</html>
